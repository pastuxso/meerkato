# üè™ Meerkato POS - Sistema Integral de Minimarket

Una aplicaci√≥n moderna y completa de Punto de Venta (POS) para minimarkets, desarrollada con **NextJS 15** y **arquitectura de monorepo**. Sistema **white label f√≠sico** con **cuatro portales separados por subdominios**, **integraci√≥n de AI/LLM**, **sistema completo de consignaci√≥n**, **portal de autoservicio para proveedores** y **app m√≥vil para domiciliarios**.

## üåü Caracter√≠sticas Principales

### üèóÔ∏è Arquitectura de Monorepo
- **4 aplicaciones NextJS independientes** con subdominios separados
- **Packages compartidos** para UI, base de datos, autenticaci√≥n y AI
- **Turborepo** para desarrollo y deployment optimizado
- **TypeScript** para seguridad de tipos en todo el proyecto

### üîê Sistema de Autenticaci√≥n Multi-Rol
- **AuthJS 5.0** con adaptador de Prisma
- **Device Agent en Go** para validaci√≥n de terminales POS
- **Roles diferenciados:** Admin, Manager, Supervisor, Cashier, Delivery, Supplier, Customer
- **Restricciones por dispositivo** para cajeros y supervisores

### ü§ñ Integraci√≥n de AI/LLM
- **OpenAI API** para funcionalidades inteligentes
- **pgvector** para embeddings y b√∫squedas sem√°nticas
- **Recomendaciones personalizadas** de productos
- **Predicci√≥n de demanda** y optimizaci√≥n de inventario
- **Optimizaci√≥n de rutas** de domicilio con AI
- **An√°lisis de precios** competitivos
- **Insights autom√°ticos** de negocio

### ü§ù Sistema Completo de Consignaci√≥n
- **Productos propios y en consignaci√≥n** con gesti√≥n separada
- **Comisiones configurables** (0% a 100%) por proveedor/producto
- **Liquidaciones autom√°ticas** con c√°lculo de comisiones
- **Proveedores terceros** con gesti√≥n independiente
- **Trazabilidad completa** del ciclo de vida del producto

### üõí Tienda en L√≠nea Integrada
- **SEO optimizado** con meta tags din√°micos y sitemap
- **P√°ginas din√°micas** para productos y categor√≠as
- **Carrito de compras** con recomendaciones AI
- **Sistema de pedidos** para domicilio
- **Pagos contra-entrega** √∫nicamente

### üöö Sistema Completo de Domicilios
- **App m√≥vil PWA** ultra-optimizada para domiciliarios
- **Tracking GPS** en tiempo real
- **Rutas optimizadas** por AI
- **Pagos contra-entrega** (efectivo, tarjeta, transferencias)
- **Gesti√≥n de zonas** de entrega
- **Liquidaci√≥n autom√°tica** de domiciliarios

## üì± Aplicaciones del Monorepo

### üè™ [meerkato.co] - Storefront (Puerto 3000)
**Tienda en l√≠nea p√∫blica para clientes**
- Cat√°logo de productos con b√∫squeda inteligente
- Sistema de pedidos para domicilio
- Recomendaciones AI personalizadas
- SEO completo y structured data
- Programa de fidelizaci√≥n

### üíº [pos.meerkato.co] - POS Admin (Puerto 3001)
**Panel administrativo para el minimarket**
- Dashboard con insights AI en tiempo real
- M√≥dulo de ventas presenciales
- Gesti√≥n completa de inventario
- Control de turnos y cajeros
- Gesti√≥n de domicilios con tracking GPS
- Sistema de consignaci√≥n y liquidaciones
- Administraci√≥n del portal de proveedores
- Reportes avanzados con an√°lisis AI

### ü§ù [proveedores.meerkato.co] - Portal Proveedores (Puerto 3002)
**Portal de autoservicio para proveedores**
- Dashboard personalizado del proveedor
- Gesti√≥n aut√≥noma de cat√°logos
- Carga masiva de productos (Excel/CSV)
- Actualizaci√≥n de precios en tiempo real
- Gesti√≥n de √≥rdenes de compra
- Programaci√≥n de entregas
- Reportes de performance y ventas
- Comunicaci√≥n directa con el minimarket

### üöö [entrega.meerkato.co] - Delivery PWA (Puerto 3003)
**App m√≥vil para domiciliarios**
- PWA instalable como app nativa
- Dashboard de entregas del d√≠a
- Navegaci√≥n con GPS y rutas optimizadas AI
- Procesamiento de pagos contra-entrega
- Tracking en tiempo real
- Liquidaci√≥n de efectivo y comisiones
- Comunicaci√≥n con el centro de operaciones

### üîê Device Agent (Puerto 8181)
**Agente de seguridad en Go**
- Validaci√≥n de terminales POS autorizadas
- Fingerprinting de hardware
- Tokens rotativos de seguridad
- API REST localhost-only

## üóÑÔ∏è Base de Datos y Tecnolog√≠as

### **PostgreSQL con pgvector**
- **Prisma ORM** para gesti√≥n de datos
- **Extensi√≥n pgvector** para embeddings AI
- **Soft delete** implementado en todas las tablas
- **Esquema completo** con m√°s de 30 tablas
- **Migraciones autom√°ticas** y seed de datos demo

### **Stack Tecnol√≥gico**
- **Frontend:** NextJS 15.5, React 18, TypeScript
- **Styling:** Tailwind CSS + shadcn/ui
- **Base de Datos:** PostgreSQL + pgvector
- **ORM:** Prisma
- **Auth:** AuthJS 5.0 (beta)
- **AI:** OpenAI API + embeddings
- **Monorepo:** Turborepo
- **Deployment:** Vercel + Docker

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos
- **Node.js 20+**
- **npm 10+**
- **Docker & Docker Compose** (para base de datos)
- **Go 1.21+** (para device agent)
- **PostgreSQL** con extensi√≥n pgvector

### 1. Configuraci√≥n Inicial
```bash
# Clonar el repositorio
git clone <repository-url>
cd meerkato-pos

# Ejecutar script de configuraci√≥n autom√°tica
./scripts/setup-dev.sh
```

### 2. Configuraci√≥n Manual (Alternativa)

#### Instalar Dependencias
```bash
npm install
```

#### Configurar Base de Datos
```bash
# Iniciar PostgreSQL con Docker
docker-compose up -d postgres

# Crear schema y migrar
npm run db:push

# Poblar con datos demo
npm run db:seed
```

#### Configurar Subdominios Locales
Agregar a `/etc/hosts` (macOS/Linux) o `C:\Windows\System32\drivers\etc\hosts` (Windows):
```
127.0.0.1 meerkato.local
127.0.0.1 pos.meerkato.local
127.0.0.1 proveedores.meerkato.local
127.0.0.1 entrega.meerkato.local
```

#### Compilar Device Agent
```bash
cd device-agent
go mod tidy
go build -o device-agent main.go
```

#### Configurar Variables de Entorno
```bash
cp .env.example .env.local
# Editar .env.local con tus configuraciones
```

### 3. Ejecutar en Desarrollo

#### Opci√≥n 1: Script Autom√°tico
```bash
./scripts/start-dev.sh
```

#### Opci√≥n 2: Manual
```bash
# Terminal 1: Todas las apps NextJS
npm run dev

# Terminal 2: Device Agent
cd device-agent && ./device-agent

# Terminal 3: Base de datos (si no est√° corriendo)
docker-compose up postgres
```

## üìã Cuentas de Prueba

| Rol | Email | Contrase√±a | Notas |
|-----|-------|------------|-------|
| **Admin** | admin@meerkato.co | password123 | Acceso completo |
| **Manager** | manager@meerkato.co | password123 | Gesti√≥n operativa |
| **Supervisor** | supervisor@meerkato.co | password123 | Requiere device agent |
| **Cashier** | cashier@meerkato.co | password123 | Requiere device agent |
| **Delivery** | delivery@meerkato.co | password123 | App m√≥vil |
| **Supplier** | supplier@distribuidora.co | password123 | Portal proveedores |
| **Customer** | customer@gmail.com | password123 | Tienda en l√≠nea |

## üåê URLs de Desarrollo

| Aplicaci√≥n | URL | Puerto |
|------------|-----|--------|
| **Storefront** | http://meerkato.local:3000 | 3000 |
| **POS Admin** | http://pos.meerkato.local:3001 | 3001 |
| **Suppliers Portal** | http://proveedores.meerkato.local:3002 | 3002 |
| **Delivery PWA** | http://entrega.meerkato.local:3003 | 3003 |
| **Device Agent** | http://localhost:8181 | 8181 |
| **Database Admin** | http://localhost:8080 | 8080 |

## üìä Funcionalidades Implementadas

### ‚úÖ Sistema Base
- [x] Arquitectura de monorepo con Turborepo
- [x] Autenticaci√≥n multi-rol con AuthJS
- [x] Base de datos PostgreSQL + pgvector
- [x] Device Agent en Go para seguridad
- [x] UI compartida con shadcn/ui

### ‚úÖ Gesti√≥n de Productos
- [x] Cat√°logo con m√∫ltiples c√≥digos de barras
- [x] Clasificaci√≥n: Propios, Consignaci√≥n, Ambos
- [x] M√©todos de costeo (FIFO, LIFO, Promedio)
- [x] Gesti√≥n de categor√≠as y precios
- [x] Control de inventario y stock

### ‚úÖ Sistema de Consignaci√≥n
- [x] Proveedores terceros
- [x] Comisiones configurables (0% a 100%)
- [x] Liquidaciones autom√°ticas
- [x] Trazabilidad completa
- [x] Reportes especializados

### ‚úÖ Portal de Proveedores
- [x] Dashboard personalizado
- [x] Gesti√≥n de cat√°logos
- [x] √ìrdenes de compra digitales
- [x] Programaci√≥n de entregas
- [x] Comunicaci√≥n integrada

### ‚úÖ Sistema de Domicilios
- [x] App m√≥vil PWA
- [x] Tracking GPS simulado
- [x] Rutas optimizadas AI
- [x] Pagos contra-entrega
- [x] Liquidaci√≥n de domiciliarios

### ‚úÖ Tienda en L√≠nea
- [x] Cat√°logo p√∫blico SEO-optimizado
- [x] Sistema de pedidos
- [x] Carrito de compras
- [x] P√°ginas din√°micas de productos
- [x] Recomendaciones AI

### ‚úÖ Integraci√≥n AI/LLM
- [x] Servicio AI con OpenAI
- [x] Embeddings con pgvector
- [x] Recomendaciones de productos
- [x] Predicci√≥n de demanda
- [x] Optimizaci√≥n de precios
- [x] Insights de negocio

### ‚úÖ Ventas y Reportes
- [x] M√≥dulo de ventas POS
- [x] Control de turnos
- [x] Dashboard con m√©tricas
- [x] Reportes b√°sicos
- [x] An√°lisis por AI

## üîß Scripts Disponibles

### Desarrollo
```bash
npm run dev              # Ejecutar todas las apps en desarrollo
npm run build            # Compilar todas las apps
npm run lint             # Ejecutar linting
npm run format           # Formatear c√≥digo con Prettier
```

### Base de Datos
```bash
npm run db:push          # Aplicar schema a la base de datos
npm run db:seed          # Poblar con datos demo
npm run db:migrate       # Ejecutar migraciones
npm run db:studio        # Abrir Prisma Studio
```

### Device Agent
```bash
cd device-agent
go run main.go           # Ejecutar en desarrollo
go build -o device-agent main.go  # Compilar
```

## üåç Despliegue en Producci√≥n

### Vercel (Recomendado)
1. **Configurar proyectos separados** en Vercel para cada app
2. **Configurar variables de entorno** en cada proyecto
3. **Configurar subdominios** en tu dominio
4. **Deploy autom√°tico** desde Git

### Docker
```bash
# Construir im√°genes
docker build -t meerkato-storefront ./apps/storefront
docker build -t meerkato-pos ./apps/pos
docker build -t meerkato-suppliers ./apps/suppliers
docker build -t meerkato-delivery ./apps/delivery

# Ejecutar con docker-compose
docker-compose -f docker-compose.prod.yml up -d
```

## üîê Seguridad

### Autenticaci√≥n
- **AuthJS 5.0** con adaptador Prisma
- **Sesiones JWT** con tokens seguros
- **Device validation** para terminales POS
- **Role-based access control** (RBAC)

### Device Agent
- **Solo conexiones localhost**
- **Tokens rotativos** cada 15 minutos
- **Fingerprinting de hardware**
- **Validaci√≥n de sessiones**

### Base de Datos
- **Soft delete** en todas las tablas
- **Auditor√≠a completa** de transacciones
- **Encriptaci√≥n de passwords** con bcrypt
- **Validaci√≥n con Zod** en APIs

## üìà Funcionalidades AI Implementadas

### Recomendaciones
- **Productos similares** usando similitud vectorial
- **Recomendaciones personalizadas** por comportamiento del cliente
- **Cross-selling y up-selling** autom√°tico

### Optimizaci√≥n
- **Predicci√≥n de demanda** usando datos hist√≥ricos
- **Optimizaci√≥n de precios** con an√°lisis de competencia
- **Rutas de entrega** optimizadas con algoritmos inteligentes
- **Gesti√≥n de inventario** predictiva

### An√°lisis
- **Insights de negocio** generados autom√°ticamente
- **An√°lisis de tendencias** de venta
- **Detecci√≥n de anomal√≠as** en transacciones
- **Reportes inteligentes** con explicaciones contextuales

## üîÑ Soft Delete y Auditor√≠a

### Pol√≠tica de Eliminaci√≥n
- **NUNCA se hace DELETE f√≠sico** de registros
- **Soft delete obligatorio** con campos:
  - `deleted_at` (timestamp)
  - `deleted_by` (usuario)
  - `deletion_reason` (motivo)

### Auditor√≠a Completa
- **Trazabilidad total** de transacciones
- **Logs de cambios** en precios y costos
- **Historial de liquidaciones**
- **Auditor√≠a de interacciones** con proveedores

## üì± Progressive Web App (PWA)

### App de Domiciliarios
- **Instalable** como app nativa
- **Offline capability** para funcionalidad b√°sica
- **Push notifications** para nuevos pedidos
- **Optimizada para mobile** con touch targets grandes
- **Service Workers** para cache inteligente

## ü§ù Contribuir

### Estructura del Proyecto
```
meerkato-pos/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ storefront/      # Tienda en l√≠nea
‚îÇ   ‚îú‚îÄ‚îÄ pos/             # Panel administrativo
‚îÇ   ‚îú‚îÄ‚îÄ suppliers/       # Portal proveedores
‚îÇ   ‚îî‚îÄ‚îÄ delivery/        # App domiciliarios
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ ui/              # Componentes compartidos
‚îÇ   ‚îú‚îÄ‚îÄ database/        # Prisma + tipos
‚îÇ   ‚îú‚îÄ‚îÄ auth/            # Autenticaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ ai/              # Servicios AI
‚îú‚îÄ‚îÄ device-agent/        # Agente Go
‚îú‚îÄ‚îÄ scripts/             # Scripts de desarrollo
‚îî‚îÄ‚îÄ database/            # Configuraci√≥n DB
```

### Flujo de Desarrollo
1. **Fork** el repositorio
2. **Crear branch** para feature
3. **Desarrollar** con TypeScript y tests
4. **Seguir convenciones** de c√≥digo
5. **Submit PR** con descripci√≥n detallada

## üìû Soporte

### Documentaci√≥n
- **README completo** con instrucciones detalladas
- **C√≥digo comentado** en componentes complejos
- **Scripts automatizados** para setup
- **Ejemplos de uso** en cada funcionalidad

### Issues y Bugs
- **Reportar issues** en GitHub
- **Incluir logs** y pasos para reproducir
- **Especificar entorno** y versiones
- **Screenshots** si es pertinente

---

## üèÜ Tecnolog√≠as Utilizadas

| Categor√≠a | Tecnolog√≠a | Versi√≥n |
|-----------|------------|---------|
| **Frontend** | NextJS | 15.5 |
| **React** | React | 18.3 |
| **Language** | TypeScript | 5.6 |
| **Styling** | Tailwind CSS | 3.4 |
| **UI Library** | shadcn/ui | Latest |
| **Database** | PostgreSQL | 16+ |
| **Vector DB** | pgvector | Latest |
| **ORM** | Prisma | 5.22 |
| **Auth** | AuthJS | 5.0-beta |
| **AI** | OpenAI API | 4.69 |
| **Monorepo** | Turborepo | 2.3 |
| **Device Agent** | Go | 1.21+ |
| **Deployment** | Vercel | Latest |
| **Containers** | Docker | Latest |

---

**üè™ Meerkato POS** - Sistema integral de punto de venta para minimarkets del futuro.

*Desarrollado con ‚ù§Ô∏è usando las mejores pr√°cticas de desarrollo moderno.*